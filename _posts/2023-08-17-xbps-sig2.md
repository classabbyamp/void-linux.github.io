---
title: XBPS Signing Change (and a bonus Infrastructure Spotlight)
layout: post
---

In preparation for the upcoming OpenSSL 3 update, XBPS has [slightly
tweaked](https://github.com/void-linux/xbps/pull/565) how signatures are created
and verified, resulting in a new type of signature file,
`<pkgname>.<arch>.xbps.sig2`. For most users, this change will not affect you:
after updating XBPS to `0.59.1_9`, it will use those new signatures when
downloading packages seamlessly. However, if you host a personal repository for
your own packages, you will need to either re-sign the repository with
`xbps-rindex -S` on XBPS `0.59.1_9`, or use the
[xbps-legacy-sign](https://github.com/void-linux/xbps-legacy-sign) tool, which
will create signatures of both types. This tool was written for Void's package
signing process, to ensure both the old `.sig` and new `.sig2` signatures are
created properly.

This change also brings some simplifications to how Void moves packages around
the infrastructure. [In a previous post]({% post_url
2023-02-11-1-new-repo-fastly %}), the functions of the internal "Shadow Repo"
were described, but that post didn't mention that the Shadow Repo is hosted on
the `musl` builder. Thus, the flow of packages in the building, signing, and
mirroring process looks like this:

<img src="/assets/img/old-sync.svg" alt="diagram of the old package flow" style="max-height: 70vh" />

You might be thinking to yourself, "why send packages back and forth between
machines like that? Why not just serve the Shadow Repo from the same machine
where signing happens?" and you'd be right. Due to this change in XBPS forcing
changes in some of the syncing infrastructure, we've taken the opportunity to
streamline the syncing processes. Syncs from the `musl` and `aarch64` builders
now use [lsyncd](https://lsyncd.github.io/lsyncd/) to watch for newly-built
packages and sync them to the `glibc` builder for signing, and mirrors now use
the `glibc` builder as the Shadow Repo. The flow now looks like this:

<img src="/assets/img/new-sync.svg" alt="diagram of the new package flow" style="max-height: 70vh" />
